<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - Powered by Claude</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Lucide React icons as inline SVGs
        const Send = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const ImageIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
        );

        const Loader = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin">
                <line x1="12" y1="2" x2="12" y2="6"></line>
                <line x1="12" y1="18" x2="12" y2="22"></line>
                <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                <line x1="2" y1="12" x2="6" y2="12"></line>
                <line x1="18" y1="12" x2="22" y2="12"></line>
                <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
            </svg>
        );

        const Sparkles = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                <path d="M5 3v4"></path>
                <path d="M19 17v4"></path>
                <path d="M3 5h4"></path>
                <path d="M17 19h4"></path>
            </svg>
        );

        const FileText = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <line x1="10" y1="9" x2="8" y2="9"></line>
            </svg>
        );

        const Mail = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
            </svg>
        );

        function AIChatAssistant() {
            const [messages, setMessages] = useState([
                { role: 'assistant', content: 'Hello! I\'m your AI assistant. I can answer questions in detail, analyze images, and create quizzes or postcards from them. How can I help you today?' }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const [uploadedImage, setUploadedImage] = useState(null);
            const fileInputRef = useRef(null);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setUploadedImage(e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const convertImageToBase64 = (dataUrl) => {
                return dataUrl.split(',')[1];
            };

            const getImageMediaType = (dataUrl) => {
                const match = dataUrl.match(/data:([^;]+);/);
                return match ? match[1] : 'image/jpeg';
            };

            const sendMessage = async () => {
                if ((!input.trim() && !uploadedImage) || loading) return;

                const userMessage = {
                    role: 'user',
                    content: input || (uploadedImage ? 'Analyzing image...' : ''),
                    image: uploadedImage
                };

                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setLoading(true);

                try {
                    const messageContent = [];
                    
                    if (uploadedImage) {
                        messageContent.push({
                            type: 'image',
                            source: {
                                type: 'base64',
                                media_type: getImageMediaType(uploadedImage),
                                data: convertImageToBase64(uploadedImage)
                            }
                        });
                    }

                    if (input.trim()) {
                        messageContent.push({
                            type: 'text',
                            text: input
                        });
                    } else if (uploadedImage) {
                        messageContent.push({
                            type: 'text',
                            text: 'Please analyze this image in detail and offer to create either a quiz or a postcard based on it.'
                        });
                    }

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1000,
                            messages: [
                                ...messages.filter(m => m.role !== 'system').map(m => ({
                                    role: m.role,
                                    content: m.image 
                                        ? [
                                            {
                                                type: 'image',
                                                source: {
                                                    type: 'base64',
                                                    media_type: getImageMediaType(m.image),
                                                    data: convertImageToBase64(m.image)
                                                }
                                            },
                                            { type: 'text', text: m.content }
                                        ]
                                        : m.content
                                })),
                                {
                                    role: 'user',
                                    content: messageContent
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.content) {
                        const assistantMessage = data.content
                            .filter(item => item.type === 'text')
                            .map(item => item.text)
                            .join('\n');

                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: assistantMessage
                        }]);
                    }
                } catch (error) {
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'I apologize, but I encountered an error processing your request. Please try again.'
                    }]);
                } finally {
                    setLoading(false);
                    setUploadedImage(null);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            const createQuiz = () => {
                setInput('Create a detailed quiz with 5 questions based on this image.');
            };

            const createPostcard = () => {
                setInput('Create a creative postcard message inspired by this image.');
            };

            return (
                <div className="flex flex-col h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                    {/* Header */}
                    <div className="bg-black/30 backdrop-blur-sm border-b border-purple-500/30 px-6 py-4">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-r from-purple-500 to-pink-500 p-2 rounded-lg">
                                <Sparkles />
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold text-white">AI Assistant</h1>
                                <p className="text-sm text-purple-300">Powered by Claude</p>
                            </div>
                        </div>
                    </div>

                    {/* Messages */}
                    <div className="flex-1 overflow-y-auto px-4 py-6">
                        <div className="max-w-4xl mx-auto space-y-6">
                            {messages.map((msg, idx) => (
                                <div
                                    key={idx}
                                    className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                                >
                                    <div
                                        className={`max-w-[80%] rounded-2xl px-6 py-4 ${
                                            msg.role === 'user'
                                                ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white'
                                                : 'bg-white/10 backdrop-blur-md text-white border border-white/20'
                                        }`}
                                    >
                                        {msg.image && (
                                            <img
                                                src={msg.image}
                                                alt="Uploaded"
                                                className="rounded-lg mb-3 max-w-full h-auto"
                                            />
                                        )}
                                        <p className="whitespace-pre-wrap leading-relaxed">{msg.content}</p>
                                    </div>
                                </div>
                            ))}
                            {loading && (
                                <div className="flex justify-start">
                                    <div className="bg-white/10 backdrop-blur-md rounded-2xl px-6 py-4 border border-white/20">
                                        <Loader />
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    {/* Image Preview */}
                    {uploadedImage && (
                        <div className="px-4 pb-2">
                            <div className="max-w-4xl mx-auto bg-white/10 backdrop-blur-md rounded-xl p-4 border border-purple-500/30">
                                <div className="flex items-start gap-4">
                                    <img
                                        src={uploadedImage}
                                        alt="Preview"
                                        className="w-24 h-24 object-cover rounded-lg"
                                    />
                                    <div className="flex-1">
                                        <p className="text-white mb-3">Image ready to analyze!</p>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={createQuiz}
                                                className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
                                            >
                                                <FileText />
                                                Create Quiz
                                            </button>
                                            <button
                                                onClick={createPostcard}
                                                className="flex items-center gap-2 px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg transition-colors"
                                            >
                                                <Mail />
                                                Create Postcard
                                            </button>
                                            <button
                                                onClick={() => setUploadedImage(null)}
                                                className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
                                            >
                                                Remove
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Input */}
                    <div className="bg-black/30 backdrop-blur-sm border-t border-purple-500/30 px-4 py-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex gap-3 items-end">
                                <input
                                    type="file"
                                    ref={fileInputRef}
                                    onChange={handleImageUpload}
                                    accept="image/*"
                                    className="hidden"
                                />
                                <button
                                    onClick={() => fileInputRef.current?.click()}
                                    className="p-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl transition-colors"
                                    disabled={loading}
                                >
                                    <ImageIcon />
                                </button>
                                <div className="flex-1 bg-white/10 backdrop-blur-md rounded-xl border border-white/20 focus-within:border-purple-500 transition-colors">
                                    <textarea
                                        value={input}
                                        onChange={(e) => setInput(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="Ask me anything or upload an image..."
                                        className="w-full bg-transparent text-white placeholder-gray-400 px-4 py-3 outline-none resize-none"
                                        rows="2"
                                        disabled={loading}
                                    />
                                </div>
                                <button
                                    onClick={sendMessage}
                                    disabled={loading || (!input.trim() && !uploadedImage)}
                                    className="p-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {loading ? <Loader /> : <Send />}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AIChatAssistant />, document.getElementById('root'));
    </script>
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            overflow: hidden;
        }
    </style>
</body>
</html>